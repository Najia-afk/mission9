<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mission9 - AWS Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff; min-height: 100vh; padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 30px; color: #00d9ff; }
        .status-bar { 
            display: flex; justify-content: center; gap: 10px; margin-bottom: 30px;
        }
        .status-badge {
            padding: 8px 16px; border-radius: 20px; font-weight: bold;
            background: #2d3748; border: 2px solid #4a5568;
        }
        .status-badge.success { border-color: #48bb78; color: #48bb78; }
        .status-badge.pending { border-color: #ecc94b; color: #ecc94b; }
        .status-badge.error { border-color: #fc8181; color: #fc8181; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .card {
            background: rgba(255,255,255,0.05); border-radius: 12px;
            padding: 20px; border: 1px solid rgba(255,255,255,0.1);
        }
        .card h3 { color: #00d9ff; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        .card h3 .icon { font-size: 24px; }
        .info-row { 
            display: flex; justify-content: space-between; padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .info-row:last-child { border-bottom: none; }
        .info-label { color: #a0aec0; }
        .info-value { color: #fff; font-family: monospace; word-break: break-all; }
        .info-value a { color: #00d9ff; text-decoration: none; }
        .info-value a:hover { text-decoration: underline; }
        
        .architecture {
            background: rgba(0,0,0,0.3); border-radius: 8px; padding: 20px;
            font-family: monospace; font-size: 12px; line-height: 1.6;
            white-space: pre; overflow-x: auto;
        }
        .refresh-btn {
            position: fixed; bottom: 20px; right: 20px;
            background: #00d9ff; color: #1a1a2e; border: none;
            padding: 12px 24px; border-radius: 8px; cursor: pointer;
            font-weight: bold; font-size: 14px;
        }
        .refresh-btn:hover { background: #00b8d9; }
        .timestamp { text-align: center; color: #718096; margin-top: 20px; font-size: 12px; }
        .loader { display: inline-block; width: 20px; height: 20px; border: 3px solid #4a5568;
            border-top-color: #00d9ff; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .no-data { text-align: center; padding: 40px; color: #718096; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ Mission9 - AWS Infrastructure</h1>
        
        <div class="status-bar">
            <span class="status-badge" id="status">Loading...</span>
        </div>
        
        <div class="grid">
            <div class="card">
                <h3><span class="icon">â˜ï¸</span> S3 Bucket</h3>
                <div id="s3-info"><div class="loader"></div></div>
            </div>
            
            <div class="card">
                <h3><span class="icon">âš¡</span> EMR Cluster</h3>
                <div id="emr-info"><div class="loader"></div></div>
            </div>
            
            <div class="card">
                <h3><span class="icon">ğŸ”‘</span> Access</h3>
                <div id="access-info"><div class="loader"></div></div>
            </div>
            
            <div class="card">
                <h3><span class="icon">ğŸ“Š</span> Dataset</h3>
                <div id="dataset-info"><div class="loader"></div></div>
            </div>
        </div>
        
        <div class="card" style="margin-top: 20px;">
            <h3><span class="icon">ğŸ—ï¸</span> Architecture</h3>
            <div class="architecture" id="architecture">Loading...</div>
        </div>
        
        <div class="timestamp" id="timestamp"></div>
    </div>
    
    <button class="refresh-btn" onclick="loadData()">ğŸ”„ Refresh</button>
    
    <script>
        async function loadData() {
            try {
                const response = await fetch('infra/status.json?' + Date.now());
                const data = await response.json();
                renderDashboard(data);
            } catch (e) {
                document.getElementById('status').textContent = 'âŒ No status.json - Run: terraform apply';
                document.getElementById('status').className = 'status-badge error';
                document.querySelectorAll('.loader').forEach(l => l.innerHTML = '<span class="no-data">Deploy first</span>');
            }
        }
        
        function renderDashboard(data) {
            // Status
            const statusEl = document.getElementById('status');
            if (data.emr_state === 'WAITING') {
                statusEl.textContent = 'âœ… READY';
                statusEl.className = 'status-badge success';
            } else if (data.emr_state === 'TERMINATED' || data.emr_state === 'TERMINATED_WITH_ERRORS') {
                statusEl.textContent = 'âŒ ' + data.emr_state;
                statusEl.className = 'status-badge error';
            } else {
                statusEl.textContent = 'â³ ' + (data.emr_state || 'DEPLOYING');
                statusEl.className = 'status-badge pending';
            }
            
            // S3
            document.getElementById('s3-info').innerHTML = `
                <div class="info-row"><span class="info-label">Bucket</span><span class="info-value">${data.s3_bucket || '-'}</span></div>
                <div class="info-row"><span class="info-label">Region</span><span class="info-value">${data.region || 'eu-west-1'}</span></div>
                <div class="info-row"><span class="info-label">Console</span><span class="info-value"><a href="https://s3.console.aws.amazon.com/s3/buckets/${data.s3_bucket}" target="_blank">Open â†’</a></span></div>
            `;
            
            // EMR
            document.getElementById('emr-info').innerHTML = `
                <div class="info-row"><span class="info-label">Cluster ID</span><span class="info-value">${data.emr_cluster_id || '-'}</span></div>
                <div class="info-row"><span class="info-label">State</span><span class="info-value">${data.emr_state || '-'}</span></div>
                <div class="info-row"><span class="info-label">Master DNS</span><span class="info-value">${data.emr_master_dns || '-'}</span></div>
                <div class="info-row"><span class="info-label">Instances</span><span class="info-value">1 Master + 2 Workers (m5.xlarge)</span></div>
            `;
            
            // Access
            const jupyterUrl = data.emr_master_dns ? `https://${data.emr_master_dns}:9443` : '-';
            document.getElementById('access-info').innerHTML = `
                <div class="info-row"><span class="info-label">JupyterHub</span><span class="info-value"><a href="${jupyterUrl}" target="_blank">${jupyterUrl}</a></span></div>
                <div class="info-row"><span class="info-label">Credentials</span><span class="info-value">jovyan / jupyter</span></div>
                <div class="info-row"><span class="info-label">SSH Key</span><span class="info-value">keys/mission9-key.pem</span></div>
            `;
            
            // Dataset
            document.getElementById('dataset-info').innerHTML = `
                <div class="info-row"><span class="info-label">Source</span><span class="info-value">OC fruits.zip</span></div>
                <div class="info-row"><span class="info-label">Images</span><span class="info-value">~22,688 (Test set)</span></div>
                <div class="info-row"><span class="info-label">S3 Path</span><span class="info-value">s3://${data.s3_bucket}/Test/</span></div>
            `;
            
            // Architecture
            document.getElementById('architecture').textContent = `
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AWS eu-west-1 (Ireland)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚   S3 Bucket     â”‚         â”‚         EMR Cluster                 â”‚  â”‚
â”‚   â”‚   ${(data.s3_bucket || '').substring(0,20).padEnd(20)}â”‚         â”‚   ${(data.emr_cluster_id || '-').padEnd(25)}    â”‚  â”‚
â”‚   â”‚                 â”‚         â”‚                                     â”‚  â”‚
â”‚   â”‚  /Test/         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚  â”‚
â”‚   â”‚  /Results/      â”‚         â”‚  â”‚ Master  â”‚    â”‚ Worker1 â”‚        â”‚  â”‚
â”‚   â”‚  /logs/         â”‚         â”‚  â”‚m5.xlargeâ”‚    â”‚m5.xlargeâ”‚        â”‚  â”‚
â”‚   â”‚                 â”‚         â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚       â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚  â”‚
â”‚                               â”‚       â”‚         â”‚ Worker2 â”‚        â”‚  â”‚
â”‚                               â”‚       â”‚         â”‚m5.xlargeâ”‚        â”‚  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚       â–¼         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  â”‚
â”‚   â”‚   IAM Roles     â”‚         â”‚  JupyterHub :9443                  â”‚  â”‚
â”‚   â”‚  emr-service    â”‚         â”‚  Spark UI   :4040                  â”‚  â”‚
â”‚   â”‚  emr-ec2        â”‚         â”‚                                     â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            `;
            
            // Timestamp
            document.getElementById('timestamp').textContent = 
                'Last updated: ' + new Date(data.timestamp || Date.now()).toLocaleString();
        }
        
        // Auto-refresh every 30s
        loadData();
        setInterval(loadData, 30000);
    </script>
</body>
</html>
